<gui:with-models>
	<gui:model id="customerData" src="/api/customer/${customerId}/data" type="json">
	<gui:model id="customerOrders" src="/api/customer/${customerId}/orders" type="json">
	<gui:model id="adminUser" src="/api/adminUser/${adminId}" type="json">
	
	<h1>
		Customer:
		<gui:insert model="customerData" field="personal.firstName" />
		<gui:insert model="customerData" field="personal.lastName" />
	</h1>
	
	<h1>Orders:</h1>
	<ul>
		<gui:repeat model="customerOrders" elementModel="order">
			<li class="foo">
				<b><gui:insert model="order" field="orderNumber" /></b>
				<gui:insert model="order" field="date" />
			</li>
		</gui:repeat>
	</ul>
	
	<gui:form method="POST" action="/api/customer/sendMail">
		<gui:form.text name="subject" label="Subject Line" required="true" trim="true">
			<gui:normalize id="lowercase">
			<gui:validate id="string" minLength="3" maxLength="50" regex="foo[^a-zA-Z]+" glob="foo*" />
			<gui:focus />
		</gui:form.text>
		<gui:form.text name="targetAddress" label="Target Address" model="customerData" field="contact.email" />
		<gui:form.textarea name="message" label="Message">
			<gui:value>
				Dear <gui:panel src="/gui/customer-salutation-with-name-panel.xml" model="customerData" />,
				
				<gui:cursor />
				
				Yours,
				<gui:panel src="/gui/shop-employee-panel.xml" model="adminUser" />
				
				<gui:panel src="/gui/email-footer.xml" />
			</gui:value>
		</gui:form.textarea> 
	</gui:form>
	
</gui:with-models>
